var development=!0,w=window,store=w.localStorage,isEven=function e(n){if(!!development&&console.log("in isEven",n),!n)throw new Erorr("no num passed to determine even or odd");return parseInt(n,10)%2===0},getRandomNumber=function e(){var n=Math.ceil(11111),o=Math.floor(44444);return Math.floor(Math.random()*(o-n+1))+n},encode=function e(n){if(!n)throw new Error("no string to encode");return w.btoa(n)},decode=function e(n){if(!n)throw new Error("no string to decode");return w.atob(n)},insertControlNumber=function e(n,o){if(2!==arguments.length)throw new Error("control number of chromotide not passed to insertControlNumber");var t=o.split("-");return t[0]=n,t.join("-")},setFatherControlNumber=function e(n){if(1!==arguments.length)throw new Error("Fy not sent to setFatherControlNumber");var o=getRandomNumber(),t=n.split("-");return t[0]=getRandomNumber(),t.join("-")},setMotherControlNumber=function e(n){if(1!==arguments.length)throw new Error("Mx not sent to setMotherControlNumber");var o=getRandomNumber(),t=n.split("-");return t[0]=getRandomNumber(),t.join("-")},getFatherControlNumber=function e(n){if(1!==arguments.length)throw new Error("fathers y chromosome not sent to fatherControlNumber");var o=n.split["-"];return parseInt(o[0],10)},getMotherControlNumber=function e(n){if(1!==arguments.length)throw new Error("mothers x chromosome not sent to motherControlNumber");var o=n.split["-"];return parseInt(o[0],10)},makeMaleGonosome=function e(n,o){if(2!==arguments.length)throw new Error("not enough chromosomes passed to makeMaleGonosome");var t=[],r=getFatherControlNumber(n),i=getMotherControlNumber(o),a=insertControlNumber(r,getRandomNumber()),s=insertControlNumber(i,getRandomNumber());return t.push({x:s}),t.push({y:a}),{gonosome:t}},makeFemaleGonosome=function e(n,o){if(2!==arguments.length)throw new Error("not enough chromosomes passed to makeFemaleGonosome");var t=[],r=getFatherControlNumber(n),i=getMotherControlNumber(o),a=insertControlNumber(r,getRandomNumber()),s=insertControlNumber(i,getRandomNumber());return t.push({x:a}),t.push({x:s}),{gonosome:t}},gonosome=function e(n){var o=[];{if(n)return"male"===n?(o.push({x:uuid.v4()}),o.push({y:uuid.v4()})):(o.push({x:uuid.v4()}),o.push({x:uuid.v4()})),{gonosome:o};throw new Error("no sex passed to generate gonosome")}},checkObjectLength=function e(n){var o=0;if("object"!=typeof n)return o;for(var t in n)n.hasOwnProperty(t)&&o++;return o},People=[],Person=function e(){this.id=uuid.v4(),this.type="",this.relationships={family:{id:"",parents:[],siblings:[],spouses:[],children:[]},friends:[]},this.birth={date:"",location:""},this.death={date:"",location:"",cause:""},this.lifespan=0,this.name={first:"",middle:"",last:{given:"",married:"",maiden:""},nickname:"",suffix:""},this.gonosome="",this.sex="",this.nationality="",this.characteristics=[],this.img=""};$(function(){var e=$("form").find("#new-person-sex"),n=$("#people"),o=$(".families"),t=n.find(".male"),r=n.find(".female"),i=function e(){var t,r=function e(){return!!development&&console.log("in getAllPeople"),$.Deferred(function e(n){try{var o=JSON.parse(store.getItem("People"));o&&(People.length=0,$.each(o,function(e,n){People.push(n.person)})),n.resolve()}catch(e){n.reject(e)}}).promise()},i=function e(o){if(!arguments.length)throw new Error("no person passed to addPersonToDom");var t="m"===o.sex,r=t?"male":"female",i=t?"true":"false",a="personCard "+r,s=moment(o.birth.date),l=s.format("MMM Do, YYYY"),m={elemID:o.id,theClass:a,isDraggable:i,firstName:o.name.first,middleName:o.name.middle,lastName:o.name.last.given,personPicture:"images/"+r+".png",bday:l};n.loadTemplate("tpl/person.html",m,{append:!0})},a=function e(n){var o={person:n},t=JSON.parse(localStorage.getItem("People"))||[];t.push(o),localStorage.setItem("People",JSON.stringify(t))},s=function e(){!!development&&console.log("in initialPersonList"),n.empty(),$.each(People,function(e,n){i(n)})},l=function e(n){!!development&&console.log("the_person: ",n),i(n),a(n)},m=function e(n){if(1!=arguments.length)throw new Error("no person id passed to getPerson");return $.Deferred(function(e){!!development&&console.log("in getPerson");var o;$.each(People,function(e,t){t.id===n&&(o=t)}),o?e.resolve(o):e.reject("no person found")}).promise()},d=function e(n,o){$(".formContainer").loadTemplate("tpl/add-person-form.html",{newLastName:o.name.last.given,isDisabled:!0},{success:formBinding})},f=function e(n){var o=$("#"+n.relationships.family.id).find(".children")},u=function e(n,o){var t=$("#"+n.relationships.family.id).find(".parents");$("#"+n.id).appendTo(t),$("#"+o.id).appendTo(t)},p=function e(n,o){!!development&&console.log("in createChild");var t=new Person;return t.relationships.family.parents.push({father:o.id}),t.relationships.family.parents.push({mother:n.id}),t.relationships.family.id=o.relationships.family.id,t},c=function e(n,o,t){u(n,o),f(t)};return startFamily=function e(n,t,r){var i={familyID:n.relationships.family.id,familyLastName:n.name.last.given};o.loadTemplate("tpl/new-family.html",i,{append:!0,success:c(n,t,r),error:function(e){throw new Error(e)}})},growFamily=function e(n,o){},addFamilyList=function e(n){return $.Deferred(function(e){var t={familyID:n.relationships.family.id,familyLastName:n.name.last.given};o.loadTemplate("tpl/new-family.html",data,{append:!0,success:function(){e.resolve()},error:function(n){e.reject(n)}})}).promise()},getFamilyList=function e(n){},addFamilyMembers=function e(n,o){var t=$("#"+n.relationships.family.id),r=$("#"+n.id),i=$("#"+o.id);r.addClass("parentOfChild"),i.addClass("parentOfChild")},makeThemAFamily=function e(n,o){!!development&&console.log("in makeThemAFamily");var t=n.name.last.given,r=$("#"+o.id),i=$("#"+n.id),a=r.find(".nameContainer"),s=a.find(".lastName"),l=uuid.v4();s.text(t),o.name.last.married=t,n.relationships.family.id=l,o.relationships.family.id=l,addFamily(n,o)},formBinding=function e(){$("form").off("submit").on("submit",function(e){!!development&&console.log("in submit form"),e.preventDefault(),e.stopPropagation();var n=$(e.target),o=n.find("#new-person-sex"),r=function e(){$(".formContainer").fadeOut().css("background-color","inherit").empty()};return t?(t.name.first=$("#first_name").val(),t.name.middle=$("#middle_name").val(),t.name.last.given=$("#last_name").val(),t.birth.date=moment($("#birthdate").val(),"YYYY-MM-DD"),t.sex=o.val(),!!development&&console.log("newPerson: ",t),People.push(t),l(t),void r()):void alert("no person")})},bindings=function e(){!!development&&console.log("in bindings");var o=$("nav"),r=o.find("button"),i=function e(n){!!development&&console.log("in createItem",n);var o=$(".formContainer"),r="white";"male"===n&&(t=new Person),t.sex="male"===n?"m":"f",o.is(":hidden")&&o.show(),o.css("background-color",r),o.loadTemplate("tpl/add-person-form.html",{newPersonSex:t.sex},{success:formBinding})},a=function e(){$(".formContainer").fadeOut().css("background-color","inherit").empty()},s=function e(n){!!development&&console.log("elem: ",n);var o=$("#"+n),t=o.siblings();t.hide(),o.fadeIn()};r.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation();var n=$(e.target),o=n.data("method"),t,r;"create"===o?(r=n.data("item"),!!development&&console.log("item: ",r),i(r)):"reveal"===o&&(t=n.data("element"),s(t))}),n.off("dragstart",".male").on("dragstart",".male",function(e){e.originalEvent.dataTransfer.setData("daddy",$(e.target).attr("id"))}),n.off("dragover",".female").on("dragover",".female",function(e){return e.preventDefault(),!1}),n.off("dragenter",".female").on("dragenter",".female",function(e){return e.preventDefault(),!1}),n.off("drop",".female").on("drop",".female",function(e){function n(e){return $.Deferred(function(n){$.when(m(e)).then(function(e){s=e,n.resolve()})}).promise()}function o(e){return $.Deferred(function(n){$.when(m(e)).then(function(e){l=e,n.resolve()})}).promise()}function t(){var e=l.relationships.family.id?l.relationships.family.id:"",n=s.relationships.family.id?s.relationships.family.id:"",o=p(l,s);if(e&&n&&e===n)!!development&&console.log("they are married"),growFamily(s,l,o);else{!!development&&console.log("the are not yet married");var t=uuid.v4();s.relationships.family.id=t,l.relationships.family.id=t,o.relationships.family.id=t,startFamily(s,l,o)}}!!development&&console.log("just dropped"),e.preventDefault();var r=$(this),i=r.attr("id"),a=e.originalEvent.dataTransfer.getData("daddy"),s,l,d;$.when(n(a)).then(function(){$.when(o(i)).then(t())}),$(".formContainer").is(":hidden")&&$(".formContainer").fadeIn().promise().done(function(){$("form").find("input").first().focus()})}),$("form").off("submit").on("submit",function(e){!!development&&console.log("in submit form"),e.preventDefault(),e.stopPropagation();var n=$(e.target),o=n.find("#new-person-sex");return t?(t.name.first=$("#first_name").val(),t.name.middle=$("#middle_name").val(),t.name.last.given=$("#last_name").val(),t.birth.date=moment($("#birthdate").val(),"YYYY-MM-DD"),t.sex=o.val(),People.push(t),l(t),void a()):void alert("no person")})},{init:function(){$("#people").hide(),$.when(r()).then(function e(){!!development&&console.log("in getAllPeopleSuccess"),bindings(),People.length&&development&&(window.People=People),!!People.length&&s()},function e(n){!!development&&console.error("in getAllPeopleFailure",n)})}}}();i.init()});